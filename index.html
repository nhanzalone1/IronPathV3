<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0f0f13">
<title>NetGains V18</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root { --bg:#0f0f13; --card:#1a1a24; --text:#fff; --accent:#ff4757; --success:#2ed573; --input:#121212; --border:#333; }
  * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; font-family:-apple-system, system-ui, Roboto, sans-serif; }
  body { margin:0; padding:0; background:var(--bg); color:var(--text); padding-bottom:90px; }
  
  .hidden { display:none !important; }
  .btn { width:100%; padding:14px; border:none; border-radius:10px; font-weight:800; margin-top:10px; cursor:pointer; text-transform:uppercase; font-size:13px; }
  .btn-main { background:linear-gradient(135deg, #ff4757, #ff6b81); color:#fff; }
  .btn-sec { background:#333; color:#fff; border:1px solid #444; }
  .btn-sm { padding:8px; width:auto; display:inline-block; font-size:11px; margin:0; }
  
  input { background:var(--input); border:1px solid var(--border); color:#fff; padding:12px; border-radius:8px; width:100%; font-size:16px; margin-bottom:5px; text-align:center; }
  .input-wrapper { position:relative; width:100%; }
  .input-unit { position:absolute; right:10px; top:50%; transform:translateY(-50%); font-size:10px; color:#666; font-weight:bold; }

  /* TOGGLE */
  #unit-toggle { position:fixed; top:15px; right:15px; background:#222; border:1px solid #444; color:var(--accent); padding:8px 12px; border-radius:20px; font-weight:800; font-size:11px; z-index:9999; cursor:pointer; }

  /* VIEWS */
  .view { padding:20px; max-width:600px; margin:0 auto; }
  h1 { text-align:center; margin:25px 0 5px; font-weight:900; font-size:24px; }
  .sub { text-align:center; color:#666; font-size:11px; letter-spacing:2px; margin-bottom:25px; text-transform:uppercase; }

  /* PROGRAM STYLES */
  .week { background:var(--card); border-radius:12px; margin-bottom:15px; border:1px solid #333; overflow:hidden; }
  .week-head { display:flex; justify-content:space-between; padding:15px; background:#222; border-bottom:1px solid #333; font-weight:bold; }
  .day-row { padding:15px; border-bottom:1px solid #222; position:relative; }
  
  .day-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
  .day-check-area { display:flex; align-items:center; gap:10px; }
  
  /* CIRCLE CHECKBOX */
  .day-circle { width:26px; height:26px; border:2px solid #555; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; background:#111; z-index:50; }
  .day-circle.checked { background:var(--success); border-color:var(--success); color:#000; font-weight:bold; }
  .day-circle.checked::after { content:'‚úì'; }

  .lift-row { display:flex; justify-content:space-between; font-size:13px; margin-bottom:5px; padding-bottom:5px; border-bottom:1px solid #222; }
  .calc-link { color:var(--success); text-decoration:underline; cursor:pointer; font-weight:bold; }

  .warmup-box { background:#111; padding:10px; border-top:1px dashed #333; display:none; margin-top:5px; }
  .warmup-box.open { display:block; }
  .warmup-line { font-family:monospace; font-size:11px; color:#aaa; margin-bottom:4px; }

  /* MODALS */
  .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; display:none; align-items:center; justify-content:center; }
  .modal-box { background:#1e1e1e; padding:25px; border-radius:15px; width:85%; max-width:350px; border:1px solid #444; position:relative; }
  .close-x { position:absolute; top:15px; right:15px; font-size:20px; color:#666; cursor:pointer; }

  /* PLATE CALC */
  .barbell-viz { height:80px; background:#111; border:1px solid #333; margin-bottom:15px; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:8px; }
  .sleeve { height:12px; width:90%; background:#555; position:absolute; border-radius:6px; z-index:1; }
  .plate-stack { display:flex; align-items:center; gap:2px; z-index:2; }
  .viz-plate { height:0; border:1px solid rgba(0,0,0,0.3); border-radius:2px; display:flex; align-items:center; justify-content:center; font-size:9px; font-weight:bold; color:black; }
  
  /* LBS COLORS */
  .p45 { height:70px; width:18px; background:#0984e3; color:white; }
  .p35 { height:60px; width:16px; background:#fdcb6e; }
  .p25 { height:50px; width:14px; background:#00b894; }
  .p10 { height:40px; width:12px; background:#dfe6e9; }
  .p5  { height:30px; width:10px; background:#d63031; color:white; }
  .p2_5{ height:20px; width:8px; background:#636e72; color:white; }

  /* KG COLORS */
  .kg25 { height:70px; width:18px; background:#ff4757; color:white; } /* Red */
  .kg20 { height:70px; width:16px; background:#0984e3; color:white; } /* Blue */
  .kg15 { height:60px; width:14px; background:#f1c40f; } /* Yellow */
  .kg10 { height:50px; width:12px; background:#2ecc71; } /* Green */
  .kg5  { height:35px; width:10px; background:#dfe6e9; } /* White */
  .kg2_5{ height:25px; width:8px;  background:#2d3436; color:white; } /* Black */
  .kg1_25{ height:18px; width:6px; background:#b2bec3; } /* Silver */

  .plate-btn-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:15px; }
  .p-btn { background:#222; border:1px solid #444; color:white; padding:15px 0; border-radius:8px; font-weight:bold; cursor:pointer; }

  /* NAV */
  .nav { position:fixed; bottom:0; left:0; width:100%; height:80px; background:#181818; border-top:1px solid #333; display:grid; grid-template-columns:1fr 1fr 1fr; z-index:1000; padding-bottom:20px; }
  .nav-btn { background:none; border:none; color:#666; font-size:10px; font-weight:bold; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; }
  .nav-btn.active { color:var(--accent); }

  /* LOG STYLES */
  .day-card { background:var(--card); padding:15px; border-radius:12px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; border:1px solid #333; }
  .gym-selector { background:#222; padding:10px; border-radius:8px; border:1px solid #333; margin-bottom:20px; display:flex; justify-content:space-between; cursor:pointer; }
</style>
</head>
<body>

<button id="unit-toggle" onclick="toggleUnit()">LBS</button>
<div id="debug-status" style="position:fixed; bottom:90px; right:10px; font-size:9px; color:#333; z-index:9000;">Loading...</div>

<div id="modal-calc" class="modal-overlay">
  <div class="modal-box">
    <div class="close-x" onclick="closeModal('modal-calc')">‚úï</div>
    <h3>Plate Math</h3>
    <div class="barbell-viz">
        <div class="sleeve"></div>
        <div class="plate-stack" id="viz-stack"></div>
    </div>
    <input type="number" id="calc-input" oninput="updateCalcViz(this.value)">
    <div class="plate-btn-grid" id="plate-grid"></div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <button class="btn btn-sec" onclick="resetCalc()">Clear</button>
        <button class="btn btn-main" onclick="applyCalc()">Use</button>
    </div>
  </div>
</div>

<div id="modal-log" class="modal-overlay">
  <div class="modal-box">
    <div class="close-x" onclick="closeModal('modal-log')">‚úï</div>
    <h3>Log Workout</h3>
    <p style="font-size:11px; color:#888; margin-bottom:15px;">Adjust actual numbers performed.</p>
    
    <div id="log-inputs"></div> <button class="btn btn-main" onclick="confirmLog()">Save to History</button>
  </div>
</div>

<div id="view-prog" class="view">
  <h1>NETGAINS <span class="brand-span">V18</span></h1>
  <p class="sub">BAECHLE ENGINE</p>
  
  <div style="background:#222; padding:15px; border-radius:12px; margin-bottom:20px;">
    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;">
        <div><label style="font-size:10px; color:#888">SQUAT</label><input type="number" id="in-s" placeholder="-" oninput="saveInputs()"></div>
        <div><label style="font-size:10px; color:#888">BENCH</label><input type="number" id="in-b" placeholder="-" oninput="saveInputs()"></div>
        <div><label style="font-size:10px; color:#888">DEAD</label><input type="number" id="in-d" placeholder="-" oninput="saveInputs()"></div>
    </div>
    <button class="btn btn-main" onclick="genProgram()">Update Cycle</button>
  </div>
  
  <div id="prog-container"></div>
  <button class="btn btn-sec" style="margin-top:30px; border-style:dashed; color:#ff4757;" onclick="hardReset()">‚ö† Factory Reset</button>
</div>

<div id="view-log" class="view hidden">
  <h1>LOG</h1>
  <div class="gym-selector" onclick="alert('Gym Switcher coming next')">
      <div><span style="font-size:10px; color:#888">LOCATION</span><br><b id="gym-name">Main Gym</b></div>
      <div>‚ñº</div>
  </div>
  <div id="folder-list"></div>
  <button class="btn btn-sec" onclick="addFolder()">+ New Folder</button>
</div>

<div id="view-stats" class="view hidden">
  <h1>STATS</h1>
  <div class="chart-container" style="background:#111; padding:10px; border-radius:12px;">
      <canvas id="myChart"></canvas>
  </div>
  <div id="stats-text" style="text-align:center; margin-top:15px; color:#888; font-size:12px;"></div>
  <button class="btn btn-sec" onclick="exportData()">Export CSV</button>
</div>

<div class="nav">
    <button class="nav-btn active" onclick="goTab('prog', this)">üìä<br>PROG</button>
    <button class="nav-btn" onclick="goTab('log', this)">üìù<br>LOG</button>
    <button class="nav-btn" onclick="goTab('stats', this)">üìà<br>STATS</button>
</div>

<script>
// --- 1. GLOBAL STATE & INIT ---
const DB_KEY = 'netgains_v18_db';
let DATA = {
    unit: 'lbs',
    inputs: {s:'', b:'', d:''},
    progState: {},
    history: []
};

// Safe Load
try {
    const saved = localStorage.getItem(DB_KEY);
    if(saved) DATA = JSON.parse(saved);
} catch(e) {
    console.log("Resetting Data");
}

// Ensure defaults if missing
if(!DATA.unit) DATA.unit = 'lbs';
if(!DATA.inputs) DATA.inputs = {s:'', b:'', d:''};
if(!DATA.progState) DATA.progState = {};
if(!DATA.history) DATA.history = [];

// Apply Data to UI immediately
document.getElementById('in-s').value = DATA.inputs.s;
document.getElementById('in-b').value = DATA.inputs.b;
document.getElementById('in-d').value = DATA.inputs.d;
updateUnitBtn();
genProgram(); // Render program if data exists
document.getElementById('debug-status').innerText = "Status: OK";

// --- 2. CORE FUNCTIONS ---
function saveData() {
    localStorage.setItem(DB_KEY, JSON.stringify(DATA));
}

function hardReset() {
    if(confirm("Wipe everything?")) {
        localStorage.removeItem(DB_KEY);
        location.reload();
    }
}

function goTab(t, btn) {
    document.querySelectorAll('.view').forEach(e => e.classList.add('hidden'));
    document.getElementById('view-'+t).classList.remove('hidden');
    document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
    btn.classList.add('active');
    if(t === 'stats') renderStats();
}

function toggleUnit() {
    DATA.unit = (DATA.unit === 'lbs') ? 'kg' : 'lbs';
    saveData();
    updateUnitBtn();
    genProgram();
}

function updateUnitBtn() {
    document.getElementById('unit-toggle').innerText = DATA.unit.toUpperCase();
    const ph = DATA.unit === 'lbs' ? 'lbs' : 'kg';
    document.getElementById('in-s').placeholder = ph;
    document.getElementById('in-b').placeholder = ph;
    document.getElementById('in-d').placeholder = ph;
}

function saveInputs() {
    DATA.inputs.s = document.getElementById('in-s').value;
    DATA.inputs.b = document.getElementById('in-b').value;
    DATA.inputs.d = document.getElementById('in-d').value;
    saveData();
}

// --- 3. PROGRAM GENERATOR ---
function genProgram() {
    const container = document.getElementById('prog-container');
    const s = parseFloat(DATA.inputs.s);
    const b = parseFloat(DATA.inputs.b);
    const d = parseFloat(DATA.inputs.d);
    
    if(!s || !b || !d) {
        container.innerHTML = "<p style='text-align:center; color:#666; margin-top:20px;'>Enter your maxes above to generate cycle.</p>";
        return;
    }

    const step = DATA.unit === 'lbs' ? 5 : 2.5;
    const bar = DATA.unit === 'lbs' ? 45 : 20;
    const rnd = n => Math.round(n/step)*step;

    // Baechle Logic
    const s5 = rnd(s * 0.87); const
